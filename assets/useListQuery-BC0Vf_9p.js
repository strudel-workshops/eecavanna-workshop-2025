import{R as m,j as o,P as x,S as d,B as v,v as S,x as y,z as j,E as F,F as g,G as A}from"./index-DCCojSDf.js";import{C as B}from"./Close-CBjPFo8c.js";import{u as E,h as P}from"./FilterField-DDzwaT5w.js";import{C as b}from"./DataGrid-BQyJQTWY.js";import{u as w}from"./useQuery-DMuGbc9B.js";const z=({header:e="Filters",grouped:i=!0,onChange:n,onClose:c,config:u,children:s,...l})=>{const{activeFilters:r,dispatch:a}=E();let t=0;m.Children.forEach(s,p=>{if(m.isValidElement(p)&&p.props.field&&P(r.find(h=>h.field===p.props.field)))return t++});const f=()=>{a({type:"SET_ACTIVE_FILTERS",payload:[]})};return o.jsx(x,{elevation:0,variant:"outlined",...l,children:o.jsxs(d,{spacing:0,children:[e&&o.jsxs(d,{direction:"row",spacing:0,alignItems:"center",sx:{borderBottom:"1px solid",borderBottomColor:"grey.300",paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1},children:[o.jsxs(d,{direction:"row",spacing:2,flex:1,children:[o.jsx(v,{children:e}),t>0&&o.jsx(b,{label:`${t} active`,color:"primary",size:"small"})]}),o.jsx(S,{variant:"outlined",onClick:f,sx:{marginRight:1},children:"Reset"}),o.jsx(y,{onClick:c,children:o.jsx(B,{})})]}),i&&o.jsx(d,{spacing:0,children:s}),!i&&o.jsx(d,{spacing:2,sx:{padding:2},children:s})]})})},k=(e,i)=>{let n=e;return i&&(n=e.filter(c=>JSON.stringify(c).toLowerCase().indexOf(i.toLowerCase())>-1)),n},R=(e,i,n)=>{let c=e;if(e&&i.length>0){const u={};i.forEach(s=>{if(n){const l=n.find(r=>r.field===s.field);u[s.field]=l==null?void 0:l.operator}}),c=e.filter(s=>{let l=!0;return i.forEach(r=>{let a=!1;if(l===!0)switch(u[r.field]){case"contains":{s[r.field].indexOf(r.value)>-1&&(a=!0);break}case"contains-one-of":{Array.isArray(r.value)&&r.value.forEach(t=>{a||(Array.isArray(s[r.field])?s[r.field].indexOf(t)>-1&&(a=!0):s[r.field]===t&&(a=!0))});break}case"equals-one-of":{Array.isArray(r.value)&&r.value.forEach(t=>{a||s[r.field]===t&&(a=!0)});break}case"between-inclusive":{if(Array.isArray(r.value)){const t=r.value[0],f=r.value[1];s[r.field]>=t&&s[r.field]<=f&&(a=!0)}break}case"between-dates-inclusive":{if(typeof s[r.field]=="string"&&Array.isArray(r.value)&&r.value[0]&&r.value[1]){const t=j(s[r.field]);t.isAfter(r.value[0])&&t.isBefore(r.value[1])&&(a=!0)}else a=!0;break}}a||(l=!1)}),l})}return c},I=(e,i,n,c)=>{const u=k(e,c);return R(u,i,n)},M=e=>{let i=e.queryMode==="server"?F(e.activeFilters,e.filterConfigs):new URLSearchParams;e.staticParams&&Object.keys(e.staticParams).forEach(t=>{e.staticParams&&i.append(t,e.staticParams[t].toString())}),e.queryMode==="server"&&(i.append("limit",e.pageSize.toString()),i.append("offset",e.offset.toString()));const n=e.queryMode==="server"?[e.dataSource,{...e.activeFilters,pageSize:e.pageSize,offset:e.offset}]:[e.dataSource],{isPending:c,isFetching:u,isError:s,data:l,error:r,refetch:a}=w({queryKey:n,queryFn:async()=>{const t=i.toString();let f=e.dataSource;return t&&t.length>0&&(f=`${e.dataSource}?${t}`),await A(f)},placeholderData:g});return{isPending:c,isFetching:u,isError:s,data:l,error:r,refetch:a}};export{z as F,I as f,M as u};
